// Generated by CoffeeScript 1.8.0
(function() {
  var sendResponse;

  sendResponse = function(res, err, data) {
    var headers, response, statusCode;
    response = {};
    if (data) {
      response.data = data;
    }
    statusCode = 200;
    if (err != null) {
      response.error = err;
    }
    headers = {
      'content-type': 'application/json; charset=utf-8'
    };
    return res.set(headers).status(statusCode).end(JSON.stringify(response));
  };

  module.exports = function(app, endpoint, manager, middleware) {
    var routes;
    routes = [
      {
        name: 'list',
        method: 'get',
        url: endpoint.plural,
        handler: function(req, res) {
          return manager.list(function(err, data) {
            return sendResponse(res, err, data);
          });
        }
      }, {
        name: 'read',
        method: 'get',
        url: endpoint.singular,
        handler: function(req, res) {
          return manager.read(req.params.id, function(err, data) {
            return sendResponse(res, err, data);
          });
        }
      }, {
        name: 'create',
        method: 'post',
        url: endpoint.plural,
        handler: function(req, res) {
          return manager.create(req.body, function(err, data) {
            return sendResponse(res, err, data);
          });
        }
      }, {
        name: 'update',
        method: 'put',
        url: endpoint.singular,
        handler: function(req, res) {
          return manager.updateOne(req.params.id, req.body, function(err, data) {
            return sendResponse(res, err, data);
          });
        }
      }, {
        name: 'updateMultiple',
        method: 'put',
        url: endpoint.plural,
        handler: function(req, res) {
          var values;
          values = JSON.parse(req.body.values);
          return manager.updateMultiple(values, function(err, data) {
            return sendResponse(res, err, data);
          });
        }
      }, {
        name: 'delete',
        method: 'delete',
        url: endpoint.singular,
        handler: function(req, res) {
          return manager.del(req.params.id, function(err, data) {
            return sendResponse(res, err, data);
          });
        }
      }
    ];
    return routes.map(function(route) {
      return app[route.method](route.url, middleware[route.name] || [], route.handler);
    });
  };

}).call(this);
